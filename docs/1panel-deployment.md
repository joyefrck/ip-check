# 1Panel éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ åœ¨ 1Panel é¢æ¿ä¸Šéƒ¨ç½² IP-Check é¡¹ç›®ã€‚

## å‰ç½®è¦æ±‚

- âœ… å·²å®‰è£… 1Panel é¢æ¿
- âœ… æœåŠ¡å™¨å·²å®‰è£… Docker å’Œ Docker Compose
- âœ… æœ‰åŸŸåï¼ˆå¯é€‰ï¼Œç”¨äºåå‘ä»£ç†ï¼‰

## éƒ¨ç½²æ–¹å¼

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ 1Panel åº”ç”¨å•†åº—ï¼ˆæ¨èæ–°æ‰‹ï¼‰

å¦‚æœé¡¹ç›®å·²å‘å¸ƒåˆ° 1Panel åº”ç”¨å•†åº—ï¼Œå¯ä»¥ç›´æ¥å®‰è£…ã€‚

### æ–¹å¼äºŒï¼šä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰

#### æ­¥éª¤ 1ï¼šä» GitHub æ‹‰å–é¡¹ç›®

**æ–¹æ³• Aï¼šä½¿ç”¨ 1Panel ç»ˆç«¯ï¼ˆæ¨èï¼‰**

1. ç™»å½• 1Panel é¢æ¿
2. è¿›å…¥ **ä¸»æœº** â†’ **ç»ˆç«¯**
3. æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# è¿›å…¥åº”ç”¨ç›®å½•
cd /opt/1panel/apps/

# ä» GitHub å…‹éš†é¡¹ç›®
git clone https://github.com/ä½ çš„ç”¨æˆ·å/IP-Check.git ip-check

# è¿›å…¥é¡¹ç›®ç›®å½•
cd ip-check
```

**æ–¹æ³• Bï¼šä½¿ç”¨ SSH è¿æ¥æœåŠ¡å™¨**

```bash
# SSH è¿æ¥åˆ°æœåŠ¡å™¨
ssh root@ä½ çš„æœåŠ¡å™¨IP

# å…‹éš†é¡¹ç›®
cd /opt/1panel/apps/
git clone https://github.com/ä½ çš„ç”¨æˆ·å/IP-Check.git ip-check
cd ip-check
```

> ğŸ’¡ **æç¤º**ï¼šå¦‚æœæ˜¯ç§æœ‰ä»“åº“ï¼Œéœ€è¦å…ˆé…ç½® GitHub è®¿é—®ä»¤ç‰Œæˆ– SSH å¯†é’¥ã€‚

#### æ­¥éª¤ 2ï¼šé…ç½®ç¯å¢ƒå˜é‡

1. åœ¨é¡¹ç›®ç›®å½•ä¸­åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cp .env.example .env
```

2. ç¼–è¾‘ `.env` æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰ï¼š

```env
PORT=3000
NODE_ENV=production
```

#### æ­¥éª¤ 3ï¼šåœ¨ 1Panel ä¸­åˆ›å»ºå®¹å™¨

**æ–¹æ³• Aï¼šä½¿ç”¨ 1Panel çš„å®¹å™¨ç®¡ç†**

1. è¿›å…¥ **å®¹å™¨** â†’ **ç¼–æ’**
2. ç‚¹å‡» **åˆ›å»ºç¼–æ’**
3. å¡«å†™ä¿¡æ¯ï¼š
   - **åç§°**ï¼š`ip-check`
   - **è·¯å¾„**ï¼šé€‰æ‹©é¡¹ç›®ç›®å½•ï¼ˆå¦‚ `/opt/1panel/apps/ip-check`ï¼‰
   - **docker-compose.yml**ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«
4. ç‚¹å‡» **ç¡®è®¤** åˆ›å»º
5. ç‚¹å‡» **å¯åŠ¨** æŒ‰é’®å¯åŠ¨å®¹å™¨

**æ–¹æ³• Bï¼šä½¿ç”¨ç»ˆç«¯å‘½ä»¤**

1. è¿›å…¥ **ä¸»æœº** â†’ **ç»ˆç«¯**
2. æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
cd /opt/1panel/apps/ip-check
docker-compose up -d
```

#### æ­¥éª¤ 4ï¼šéªŒè¯éƒ¨ç½²

1. è¿›å…¥ **å®¹å™¨** â†’ **å®¹å™¨**
2. æŸ¥çœ‹ `ip-check` å®¹å™¨çŠ¶æ€ï¼Œåº”è¯¥æ˜¾ç¤º **è¿è¡Œä¸­**
3. ç‚¹å‡»å®¹å™¨åç§°ï¼ŒæŸ¥çœ‹æ—¥å¿—ç¡®è®¤å¯åŠ¨æˆåŠŸ
4. è®¿é—® `http://æœåŠ¡å™¨IP:3000` æµ‹è¯•

---

### æ–¹å¼ä¸‰ï¼šé…ç½®åå‘ä»£ç†ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

å¦‚æœä½ æƒ³é€šè¿‡åŸŸåè®¿é—®ï¼ˆå¦‚ `https://ip.yourdomain.com`ï¼‰ï¼Œéœ€è¦é…ç½®åå‘ä»£ç†ã€‚

#### ä½¿ç”¨ 1Panel çš„ OpenResty/Nginx

1. è¿›å…¥ **ç½‘ç«™** â†’ **ç½‘ç«™**
2. ç‚¹å‡» **åˆ›å»ºç½‘ç«™** â†’ **åå‘ä»£ç†**
3. å¡«å†™é…ç½®ï¼š
   - **åŸŸå**ï¼š`ip.yourdomain.com`
   - **ä»£ç†åœ°å€**ï¼š`http://127.0.0.1:3000`
   - **å¯ç”¨ HTTPS**ï¼šå¼€å¯ï¼ˆæ¨èï¼‰
   - **è‡ªåŠ¨ç”³è¯·è¯ä¹¦**ï¼šå¼€å¯ï¼ˆä½¿ç”¨ Let's Encryptï¼‰
4. ç‚¹å‡» **ç¡®è®¤** åˆ›å»º

#### Nginx é…ç½®ç¤ºä¾‹

å¦‚æœæ‰‹åŠ¨é…ç½®ï¼Œå‚è€ƒä»¥ä¸‹é…ç½®ï¼š

```nginx
server {
    listen 80;
    server_name ip.yourdomain.com;
    
    # é‡å®šå‘åˆ° HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name ip.yourdomain.com;
    
    # SSL è¯ä¹¦é…ç½®
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    
    # åå‘ä»£ç†é…ç½®
    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

---

## å¸¸è§æ“ä½œ

### æŸ¥çœ‹å®¹å™¨æ—¥å¿—

**åœ¨ 1Panel ä¸­ï¼š**
1. è¿›å…¥ **å®¹å™¨** â†’ **å®¹å™¨**
2. ç‚¹å‡» `ip-check` å®¹å™¨
3. ç‚¹å‡» **æ—¥å¿—** æ ‡ç­¾

**ä½¿ç”¨å‘½ä»¤è¡Œï¼š**
```bash
docker logs -f ip-check
```

### é‡å¯å®¹å™¨

**åœ¨ 1Panel ä¸­ï¼š**
1. è¿›å…¥ **å®¹å™¨** â†’ **å®¹å™¨**
2. é€‰æ‹© `ip-check` å®¹å™¨
3. ç‚¹å‡» **é‡å¯** æŒ‰é’®

**ä½¿ç”¨å‘½ä»¤è¡Œï¼š**
```bash
cd /opt/1panel/apps/ip-check
docker-compose restart
```

### åœæ­¢å®¹å™¨

**åœ¨ 1Panel ä¸­ï¼š**
1. è¿›å…¥ **å®¹å™¨** â†’ **å®¹å™¨**
2. é€‰æ‹© `ip-check` å®¹å™¨
3. ç‚¹å‡» **åœæ­¢** æŒ‰é’®

**ä½¿ç”¨å‘½ä»¤è¡Œï¼š**
```bash
cd /opt/1panel/apps/ip-check
docker-compose down
```

### æ›´æ–°åº”ç”¨

**ä» GitHub æ‹‰å–æœ€æ–°ä»£ç å¹¶é‡æ–°éƒ¨ç½²ï¼š**

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/1panel/apps/ip-check

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main  # æˆ– git pull origin masterï¼Œæ ¹æ®ä½ çš„åˆ†æ”¯å

# åœæ­¢æ—§å®¹å™¨
docker-compose down

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build
```

**åœ¨ 1Panel ä¸­æ“ä½œï¼š**

1. è¿›å…¥ **ä¸»æœº** â†’ **ç»ˆç«¯**
2. æ‰§è¡Œä¸Šè¿°å‘½ä»¤
3. æˆ–åœ¨ **å®¹å™¨** â†’ **ç¼–æ’** ä¸­ç‚¹å‡» **é‡å»º** æŒ‰é’®

### ä¿®æ”¹ç«¯å£

1. ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œä¿®æ”¹ `PORT` å€¼
2. é‡å¯å®¹å™¨ä½¿é…ç½®ç”Ÿæ•ˆ

---

## é˜²ç«å¢™é…ç½®

å¦‚æœæ— æ³•è®¿é—®ï¼Œéœ€è¦åœ¨ 1Panel ä¸­å¼€æ”¾ç«¯å£ï¼š

1. è¿›å…¥ **ä¸»æœº** â†’ **é˜²ç«å¢™**
2. ç‚¹å‡» **æ·»åŠ è§„åˆ™**
3. å¡«å†™ä¿¡æ¯ï¼š
   - **ç«¯å£**ï¼š`3000`ï¼ˆæˆ–ä½ é…ç½®çš„ç«¯å£ï¼‰
   - **åè®®**ï¼š`TCP`
   - **ç­–ç•¥**ï¼š`å…è®¸`
4. ç‚¹å‡» **ç¡®è®¤**

**æ³¨æ„**ï¼šå¦‚æœä½¿ç”¨åå‘ä»£ç†ï¼Œåªéœ€å¼€æ”¾ 80 å’Œ 443 ç«¯å£ï¼Œä¸éœ€è¦å¼€æ”¾ 3000 ç«¯å£ã€‚

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ä½¿ç”¨åå‘ä»£ç†ç¼“å­˜

åœ¨ Nginx é…ç½®ä¸­æ·»åŠ ç¼“å­˜ï¼š

```nginx
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=ip_check_cache:10m max_size=1g inactive=60m;

location / {
    proxy_cache ip_check_cache;
    proxy_cache_valid 200 10m;
    proxy_cache_key "$scheme$request_method$host$request_uri";
    # ... å…¶ä»–é…ç½®
}
```

### 2. å¯ç”¨ Gzip å‹ç¼©

```nginx
gzip on;
gzip_vary on;
gzip_proxied any;
gzip_comp_level 6;
gzip_types text/plain text/css text/xml text/javascript application/json application/javascript application/xml+rss;
```

### 3. é…ç½®èµ„æºé™åˆ¶

ç¼–è¾‘ `docker-compose.yml`ï¼Œæ·»åŠ èµ„æºé™åˆ¶ï¼š

```yaml
services:
  ip-check:
    # ... å…¶ä»–é…ç½®
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M
```

---

## æ•…éšœæ’æŸ¥

### å®¹å™¨æ— æ³•å¯åŠ¨

1. æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼š`docker logs ip-check`
2. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š`netstat -tulpn | grep 3000`
3. æ£€æŸ¥ Docker æœåŠ¡çŠ¶æ€ï¼š`systemctl status docker`

### æ— æ³•è®¿é—®åº”ç”¨

1. æ£€æŸ¥å®¹å™¨æ˜¯å¦è¿è¡Œï¼š`docker ps | grep ip-check`
2. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
3. æ£€æŸ¥åå‘ä»£ç†é…ç½®
4. æµ‹è¯•æœ¬åœ°è®¿é—®ï¼š`curl http://localhost:3000`

### å†…å­˜ä¸è¶³

1. å¢åŠ æœåŠ¡å™¨å†…å­˜
2. æˆ–åœ¨ docker-compose.yml ä¸­é™åˆ¶å†…å­˜ä½¿ç”¨
3. ä¼˜åŒ– Next.js æ„å»ºé…ç½®

---

## å®‰å…¨å»ºè®®

1. âœ… ä½¿ç”¨ HTTPSï¼ˆé€šè¿‡åå‘ä»£ç†é…ç½® SSLï¼‰
2. âœ… å®šæœŸæ›´æ–° Docker é•œåƒ
3. âœ… ä½¿ç”¨é˜²ç«å¢™é™åˆ¶è®¿é—®
4. âœ… å®šæœŸå¤‡ä»½æ•°æ®
5. âœ… ç›‘æ§å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ

---

## ç›‘æ§å’Œæ—¥å¿—

### ä½¿ç”¨ 1Panel çš„ç›‘æ§åŠŸèƒ½

1. è¿›å…¥ **ç›‘æ§** èœå•
2. æŸ¥çœ‹å®¹å™¨ CPUã€å†…å­˜ä½¿ç”¨æƒ…å†µ
3. è®¾ç½®å‘Šè­¦è§„åˆ™

### æ—¥å¿—ç®¡ç†

å»ºè®®é…ç½®æ—¥å¿—è½®è½¬ï¼Œé¿å…æ—¥å¿—æ–‡ä»¶è¿‡å¤§ï¼š

```yaml
services:
  ip-check:
    # ... å…¶ä»–é…ç½®
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
```

---

## æ€»ç»“

ä½¿ç”¨ 1Panel éƒ¨ç½² IP-Check é¡¹ç›®çš„æ¨èæµç¨‹ï¼š

1. ä¸Šä¼ é¡¹ç›®æ–‡ä»¶åˆ°æœåŠ¡å™¨
2. ä½¿ç”¨ 1Panel çš„å®¹å™¨ç¼–æ’åŠŸèƒ½å¯åŠ¨
3. é…ç½®åå‘ä»£ç†å’Œ SSL è¯ä¹¦
4. å¼€æ”¾å¿…è¦çš„é˜²ç«å¢™ç«¯å£
5. è®¿é—®åŸŸåæµ‹è¯•

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹å®¹å™¨æ—¥å¿—æˆ–å‚è€ƒæ•…éšœæ’æŸ¥éƒ¨åˆ†ã€‚
